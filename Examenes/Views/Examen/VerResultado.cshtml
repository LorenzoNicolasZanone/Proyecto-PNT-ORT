@model Examenes.Models.ViewModels.RespuestasDetalleViewModel
@{
    ViewData["Title"] = "Resultado del Examen";
    var alumno = Model.ExamenAlumno.Alumno.Usuario;
    var examen = Model.ExamenAlumno.Examen;
}

<div class="container mt-4">
    <h1 class="dashboard-title">Resultado del Examen</h1>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Tu Resultado</h5>
        </div>
        <div class="card-body">
            <p><strong>Curso:</strong> @Model.ExamenAlumno.Examen.Curso.Nombre</p>
            <p><strong>Examen:</strong> @examen.Titulo</p>
            <p><strong>Nota Final:</strong> 
                <strong class="fs-4 @(Model.ExamenAlumno.Nota >= examen.PorcentajeParaAprobacion ? "text-success" : "text-danger")">
                    @Model.ExamenAlumno.Nota?.ToString("F2")
                </strong> 
                / 100
            </p>
            <p class="mb-0">
                <strong>Respuestas Correctas:</strong> 
                @Model.ExamenAlumno.CantRespCorrectas / @Model.PreguntasCompletas.Count
            </p>
        </div>
    </div>

    <a asp-action="ListadoPorCursoAlumno" asp-route-cursoId="@Model.CursoId" class="btn btn-outline-secondary mt-2 mb-4">
        <i class="bi bi-arrow-left"></i> Volver a Mis Ex√°menes
    </a>

    <hr />

    @for (int i = 0; i < Model.PreguntasCompletas.Count; i++)
    {
        var item = Model.PreguntasCompletas[i];
        var pregunta = item.Pregunta;
        int numeroPregunta = i + 1;

        <div class="mb-4">
            <h5 class="mb-1"><strong>@numeroPregunta) @pregunta.Enunciado</strong></h5>
            
            <ul class="list-group mt-3">
                @foreach (var opcion in pregunta.Opciones.OrderBy(o => o.Id))
                {
                    string cssClass = "";
                    string icon = "bi-circle";
                    string label = "";

                    bool esLaOpcionCorrecta = opcion.EsCorrecta;
                    bool esLaOpcionQueEligio = (opcion.Id == item.OpcionSeleccionadaId);
                    
                    if (esLaOpcionQueEligio)
                    {
                        if (esLaOpcionCorrecta)
                        {
                            cssClass = "list-group-item-success";
                            icon = "bi-check-circle-fill";
                            label = "(Tu respuesta)";
                        }
                        else
                        {
                            cssClass = "list-group-item-danger"; 
                            icon = "bi-x-circle-fill";
                            label = "(Tu respuesta)";
                        }
                    }
                    else if (esLaOpcionCorrecta)
                    {
                        cssClass = "list-group-item-success";
                        icon = "bi-check-circle-fill";
                        label = "(Respuesta correcta)";
                    }
                    
                    <li class="list-group-item @cssClass">
                        <i class="bi @icon me-2"></i>
                        @opcion.Texto
                        <em class="ms-2">@label</em>
                    </li>
                }
            </ul>
        </div>
    }
</div>